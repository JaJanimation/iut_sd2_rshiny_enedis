
---
title: "Rapport d'√âtude : Influence du DPE sur la Consommation √ânerg√©tique dans le Rh√¥ne"
output: 
  html_document: 
    toc: true
    toc_float: true
    theme: cosmo
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 6)
library(httr)
library(jsonlite)
library(sf)
library(ggplot2)
library(dplyr)
library(tidyr)
library(scales)
library(tibble)
```

## üîß Filtres

```{r}
textInput("code_insee", "Code INSEE du d√©partement", value = "69")
selectInput("source_dpe", "Type de logement", choices = c("Tous", "Neuf", "Existant"), selected = "Tous")
```


```{r}
data_all <- reactive({
  load_ademe_data <- function(dataset_id, code_insee, source_label) {
    url <- paste0("https://data.ademe.fr/data-fair/api/v1/datasets/", dataset_id,
                  "/lines?page=1&size=1000&q=code_insee%3A", code_insee)
    res <- GET(url)
    if (http_error(res)) return(NULL)
    df <- fromJSON(content(res, "text"), flatten = TRUE)$results
    if (is.null(df) || nrow(df) == 0) return(NULL)
    cols <- c("type_energie_n1", "surface_habitable_logement", "typologie_logement",
              "etiquette_dpe", "conso_5_usages_ef", "conso_5_usages_par_m2_ef")
    df <- df[, intersect(cols, names(df))]
    df$source <- source_label
    df$conso_5_usages_ef <- as.numeric(df$conso_5_usages_ef)
    df$conso_5_usages_par_m2_ef <- as.numeric(df$conso_5_usages_par_m2_ef)
    df$surface_habitable_logement <- as.numeric(df$surface_habitable_logement)
    return(df)
  }

  df_neuf <- load_ademe_data("dpe02neuf", input$code_insee, "Neuf")
  df_existant <- load_ademe_data("dpe03existant", input$code_insee, "Existant")
  bind_rows(df_neuf, df_existant)
})

filtered_data <- reactive({
  df <- data_all()
  df <- df %>% filter(!is.na(etiquette_dpe), !is.na(conso_5_usages_par_m2_ef), !is.na(surface_habitable_logement))
  if (input$source_dpe != "Tous") {
    df <- df %>% filter(source == input$source_dpe)
  }
  df$etiquette_dpe <- factor(df$etiquette_dpe, levels = c("A", "B", "C", "D", "E", "F", "G"))
  df
})
```

# Contexte

Dans un contexte marqu√© par l‚Äôacc√©l√©ration du changement climatique et la hausse des co√ªts √©nerg√©tiques, la sobri√©t√© √©nerg√©tique devient une priorit√© nationale. 

Pour pallier ce probl√®me, le Diagnostic de Performance √ânerg√©tique (DPE) a √©t√© mis en place afin d‚Äô√©valuer la performance √©nerg√©tique et climatique des b√¢timents.Il consiste en une √©tiquette pouvant aller de A √† G pour chaque logement ou b√¢timent, qui √©value sa consommation d‚Äô√©nergie et son impact en terme d‚Äô√©mission de gaz √† effet de serre. Il permet d‚Äôidentifier les passoires √©nerg√©tiques, d‚Äôinformer les occupants et de recommander des travaux d‚Äôam√©lioration √† r√©aliser. Cependant, les consommations affich√©es  dans les DPE reposent sur des calculs conventionnels standardis√©s qui ne tiennent  pas en compte des usages r√©els, du mode de vie ou du taux d‚Äôoccupation.

Pour accompagner les acteurs dans la transition √©nerg√©tique, Enedis souhaite proposer des  analyses et des chiffres cl√©s. C‚Äôest dans cette perspective que s‚Äôinscrit la mise en ≈ìuvre de ce projet, notre application d‚Äôanalyse √©nerg√©tique constituant l‚Äôun des outils permettant d‚Äôobjectiver les consommations r√©elles et de guider les d√©cisions de r√©novation.



# Contexte des donn√©es

Les donn√©es utilis√©es proviennent du site de l‚ÄôADEME. Notre analyse porte sur le d√©partement du Rh√¥ne (69).
Pour chaque logement, les donn√©es que  nous avons relev√©es sont les suivantes:

* Type d‚Äô√©nergie
* Surface habitable ($m^2$)
* Typologie
* Classe DPE
* Consommation totale (kWh)
* Consommation par $m^2$ (kWh/$m^2$)
* Source : Neuf / Existant

## üìä Chiffres cl√©s

```{r}
renderTable({
  df <- filtered_data()
  n <- nrow(df)
  conso_moy <- round(mean(df$conso_5_usages_par_m2_ef, na.rm = TRUE), 2)
  cde <- round(nrow(df %>% filter(etiquette_dpe %in% c("C", "D", "E"))) / n * 100, 1)
  gaz_elec <- round(nrow(df %>% filter(type_energie_n1 %in% c("√âlectricit√©", "Gaz Naturel"))) / n * 100, 1)
  cor <- if (n > 1) round(cor(df$surface_habitable_logement, df$conso_5_usages_ef, use = "complete.obs"), 2) else "N/A"

  tibble(
    `Nombre de logements analys√©s` = n,
    `Consommation moyenne par m¬≤ (kWh/m¬≤)` = conso_moy,
    `% logements en C/D/E` = cde,
    `% gaz ou √©lectricit√©` = gaz_elec,
    `Corr√©lation surface/conso` = cor
  )
})
```

# Probl√©matique

**En quoi la classe DPE, le type d'√©nergie et la surface habitable influencent-ils la consommation √©nerg√©tique r√©elle des logements dans le Rh√¥ne ?**

# Analyse et Visualisations

## üìà R√©partition des classes DPE

```{r}
renderPlot({
  ggplot(filtered_data(), aes(x = etiquette_dpe)) +
    geom_bar(fill = "#1423dc") +
    theme_minimal() +
    labs(x = "Classe DPE", y = "Nombre de logements",
         title = paste("R√©partition des classes DPE -", input$source_dpe)) +
    scale_y_continuous(labels = comma)
})
```

Pour l‚Äôint√©gralit√© des logements du d√©partement du Rh√¥ne, l‚Äôhistogramme montre une forte concentration dans les classes C √† E, traduisant une performance √©nerg√©tique moyenne. Les classes A et B sont tr√®s peu repr√©sent√©es, surtout pour les logements ‚Äúexistants‚Äù,tandis que les logements ‚Äúneufs‚Äù tendent √† se concentrer davantage vers les classes A et B. Les classes F et G, correspondant aux passoires thermiques, restent pr√©sentes mais minoritaires, ce qui confirme l‚Äôimpact progressif des politiques de r√©novation √©nerg√©tique.

Cette r√©partition souligne la n√©cessit√© de renforcer les politiques de r√©novation pour les logements ‚Äúexistants‚Äù, encore trop consommateurs. Elle met √©galement en √©vidence l‚Äôefficacit√© des r√©glementations pour les constructions neuves.


## üìâ Consommation par m¬≤ en fonction du DPE 

```{r}
renderPlot({
  ggplot(filtered_data(), aes(x = etiquette_dpe, y = conso_5_usages_par_m2_ef)) +
    geom_boxplot(fill = "#96cd32") +
    theme_minimal() +
    labs(x = "Classe DPE", y = "Consommation par m¬≤ (kWh/m¬≤)",
         title = "Distribution par classe DPE") +
    scale_y_continuous(labels = comma)
})
```
On peut voir que plus la classe DPE est mauvaise, plus la consommation moyenne d‚Äô√©lectricit√© par m¬≤ augmente. De m√™me, les √©carts de consommation entre les diff√©rents logements augmentent. Au sein des diff√©rentes classes, la classe B est celle avec des valeurs les plus resserr√©es, en notant n√©anmoins un certain nombre d‚Äôextremums.

Ce graphique met en √©vidence le lien important entre DPE et consommation d‚Äô√©nergie au m¬≤.

## üîã R√©partition des types d‚Äô√©nergie

```{r}
renderPlot({
  ggplot(filtered_data(), aes(x = type_energie_n1)) +
    geom_bar(fill = "#1423dc") +
    coord_flip() +
    theme_minimal() +
    labs(x = "Type d'√©nergie", y = "Nombre de logements",
         title = "R√©partition des types d'√©nergie") +
    scale_y_continuous(labels = comma)
})
```
Le gaz naturel et l‚Äô√©lectricit√© sont les deux principales √©nergies les plus utilis√©es. Le fioul et le bois sont minoritaires, principalement utilis√©s dans les logements ‚Äúexistants‚Äù. Les √©nergies renouvelables restent faiblement repr√©sent√©es mais progressent dans les logements ‚Äúneufs‚Äù. Ces chiffres illustrent la d√©pendance √©nerg√©tique encore √©lev√©e aux sources fossiles.  

La transition √©nerg√©tique est amorc√©e mais in√©gale : le passage vers des √©nergies moins carbon√©es reste un enjeu majeur. Ce diagramme illustre l‚Äô√©volution progressive  vers ces syst√®mes √©nerg√©tiques plus durables dans les constructions r√©centes.


## üè† Consommation totale en fonction de la surface habitable

```{r}
renderPlot({
  ggplot(filtered_data(), aes(x = surface_habitable_logement, y = conso_5_usages_ef)) +
    geom_point(alpha = 0.5, color = "#96cd32") +
    geom_smooth(method = "lm", color = "red", se = FALSE) +
    theme_minimal() +
    labs(x = "Surface habitable (m¬≤)", y = "Consommation totale (kWh)",
         title = "Surface vs Consommation √©nerg√©tique") +
    scale_x_continuous(labels = comma) +
    scale_y_continuous(labels = comma)
})
```
La corr√©lation positive entre surface et consommation indique que plus la surface augmente, plus la consommation totale cro√Æt, mais pas de mani√®re proportionnelle. En effet, la relation n‚Äôest pas lin√©aire : certains grands logements consomment peu, tandis que certains petits logements consomment beaucoup.

La consommation d√©pend √† la fois de la taille et de la performance √©nerg√©tique du logement.
Ce graphique met en √©vidence la n√©cessit√© de consid√©rer la consommation par m¬≤ plut√¥t que la consommation totale pour des comparaisons pertinentes.

## üìä DPE √ó √ânergie

```{r}
renderTable({
  filtered_data() %>%
    count(etiquette_dpe, type_energie_n1) %>%
    pivot_wider(names_from = type_energie_n1, values_from = n, values_fill = 0)
})
```

Ce tableau met en relation la classe DPE des logements et leur source d‚Äô√©nergie principale. On observe que les logements √©lectriques sont r√©partis sur l‚Äôensemble des classes, mais sont majoritaires dans les classes A √† D, ce qui refl√®te une meilleure performance √©nerg√©tique. √Ä l‚Äôinverse, les logements utilisant le gaz naturel ou le fioul sont plus pr√©sents dans les classes E √† G, traduisant une consommation plus √©lev√©e et une efficacit√© moindre. Les √©nergies renouvelables (bois, solaire, etc.) restent marginales, mais tendent √† se concentrer dans les classes interm√©diaires ou performantes. Cette r√©partition souligne que le type d‚Äô√©nergie utilis√© influence fortement la performance √©nerg√©tique globale du logement, et que le choix √©nerg√©tique est un levier cl√© pour am√©liorer le DPE.

# Conclusion

Les indicateurs et graphiques convergent vers un m√™me constat :
* Les performances √©nerg√©tiques varient fortement selon le type de logement et la source d‚Äô√©nergie.
* Le neuf tire les r√©sultats vers le haut, tandis que l‚Äôancien reste majoritairement √©nergivore.
* La transition √©nerg√©tique est en marche mais doit s‚Äôappuyer sur des actions cibl√©es : r√©novation des passoires, substitution des √©nergies fossiles, et sensibilisation aux usages.

L‚Äôapplication Shiny constitue donc un outil d‚Äôaide √† la d√©cision permettant de suivre les KPI en temps r√©el, d‚Äô√©valuer les priorit√©s territoriales, et d‚Äôorienter les investissements de r√©novation de mani√®re objective et g√©olocalis√©e.



---

